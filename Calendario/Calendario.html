<!DOCTYPE html>
<html lang="pt-br">

<head>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <meta charset="UTF-8" />
  <title>Calend√°rio Pok√©mon GO</title>
  <style>
    /* Estilo geral da p√°gina */
    body {
      margin: 0;
      font-family: 'Arial', sans-serif;
      background-color: #121212;
      color: #ffffff;
    }

    /* Menu */
    .navbar {
      background-color: #1f1f1f;
      padding: 15px 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 300px;      /* espa√ßo entre logo e menu */
      position: sticky;
      top: 0;
      z-index: 1000;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
    }

    .navbar .logo {
      color: #fff;
      font-size: 20px;
      font-weight: bold;
      text-decoration: none;
      white-space: nowrap;      /* evita quebra da logo */
    }

    .navbar>ul {
      display: flex;
      gap: 20px;      /* diminui o espa√ßo entre os links */
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .navbar ul li {
      margin-left: 0px;      /* remove margem que separava mais ainda */
    }

    .navbar ul li a {
      color: #fff;
      text-decoration: none;
      font-weight: bold;
      padding: 8px 12px;
      border-radius: 4px;
      transition: background 0.3s;
      display: flex;
      align-items: center;      /* alinha √≠cone e texto */
      gap: 10px;      /* espa√ßo entre √≠cone e texto */
    }

    .navbar ul li a:hover {
      background-color: #333;
      border-radius: 5px;
    }

    /* Responsivo: empilha em telas pequenas */
    @media (max-width: 600px) {
      .navbar {
        flex-direction: column;
        align-items: center;
      }

      .navbar ul {
        flex-direction: column;
        gap: 10px;
      }
    }

    /* Estilo base para dropdown */
    .dropdown {
      position: relative;
    }

    .dropdown-menu {
      display: none;
      flex-direction: column;      /* for√ßa vertical */
      position: absolute;
      background-color: #2a2a2a;
      min-width: 160px;
      top: 100%;
      left: 0;
      border-radius: 5px;
      z-index: 999;
      padding: 0;
      margin: 0;
      list-style: none;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
    }

    /* For√ßa os itens a se comportarem como blocos verticais */
    .dropdown-menu li {
      width: 100%;
    }

    /* Links dentro do submenu */
    .dropdown-menu li a {
      display: block;
      padding: 10px 15px;
      color: #fff;
      text-decoration: none;
      white-space: nowrap;
    }

    /* Hover no link do submenu */
    .dropdown-menu li a:hover {
      background-color: #444;
    }

    /* Mostrar dropdown ao passar o mouse */
    .dropdown:hover .dropdown-menu {
      display: flex;
    }

    /* Cabe√ßalho */
    header {
      background-color: #1f1f1f;
      padding: 20px;
      text-align: center;
      border-bottom: 2px solid #ffcb05;
    }

    header h1 {
      margin: 0;
      font-size: 28px;
      color: #ffcb05;
    }

    header p {
      margin: 5px 0 0 0;
      font-size: 22px;
      color: #ccc;
    }

    /* Controles do calend√°rio (bot√µes e destaques) */
    .controls {
      text-align: center;
      margin: 15px 0;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
    }

    .controls button {
      background-color: #2a75bb;
      color: white;
      border: none;
      padding: 8px 12px;
      font-size: 14px;
      border-radius: 5px;
      cursor: pointer;
      flex-shrink: 0;
    }

    .destaques-container {
      display: flex;
      gap: 20px;
      justify-content: center;
      flex-wrap: wrap;
    }

    /* Estilo das caixas de destaque (temporada e ticket) */
    .evento-destaque {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      width: 220px;      /* Mesma largura fixa para ambas */
      min-height: 160px;      /* Mesma altura m√≠nima para padronizar */
      vertical-align: top;
      background-color: #1f1f1f;
      color: #fff;
      padding: 10px;
      border-radius: 10px;
      box-sizing: border-box;
      margin: 0 10px;
      text-align: center;
    }

    /* Imagem dentro do destaque */
    .evento-destaque img {
      max-width: 100%;
      height: auto;
      border-radius: 6px;
      margin-bottom: 6px;
    }

    /* Texto do hor√°rio dentro do destaque, menor e com cor clara */
    .evento-destaque .horario {
      font-size: 12px;
      color: #ccc;
      margin-top: 4px;
    }

    /* Labels dos dias da semana */
    .week-labels {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      max-width: 1000px;      /* Alinha com o calend√°rio */
      margin: 10px auto 0 auto;
      padding: 0 20px;
      text-align: center;
      color: #bbb;
      font-weight: bold;
    }

    /* Container do calend√°rio com grid de 7 colunas */
    .grid-container {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 10px;
      max-width: 1000px;
      margin: 20px auto;
      padding: 0 20px;
    }

    /* Cada c√©lula do dia */
    .day-cell {
      background-color: #1f1f1f;
      border-radius: 10px;
      min-height: 110px;
      padding: 6px;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      position: relative;
      overflow-y: auto;
    }

    /* Destaque sutil para o dia atual */
    .day-cell.hoje {
      background-color: rgba(255, 255, 150, 0.20);      /* tom amarelado sutil */
      box-shadow: 0 0 6px rgba(255, 215, 0, 0.4);      /* brilho leve dourado */
      border-radius: 6px;
    }

    /* N√∫mero do dia */
    .day-label {
      font-size: 14px;
      font-weight: bold;
      color: #aaa;
      margin-bottom: 4px;
      align-self: flex-start;
    }

    /* Eventos dentro da c√©lula */
    .event {
      background-color: #2a2a2a;
      border-radius: 8px;
      padding: 4px;
      margin: 4px 0;
      text-align: center;
      font-size: 11px;
      width: 100%;
      color: white;
      box-sizing: border-box;
      white-space: normal;
      word-wrap: break-word;
      overflow-wrap: break-word;
    }

    .event img {
      max-width: 48px;
      height: 24px;
      display: block;
      margin: 2px auto 2px auto;
    }

    /* Responsivo para telas pequenas */
    @media (max-width: 768px) {

      .grid-container,
      .week-labels {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>

<body>
  <!-- Menu carregado dinamicamente -->
  <div id="menu"></div>

  <!-- Script para carregar o menu -->
  <script>
    fetch('../menu.html')
      .then(response => response.text())
      .then(html => {
        document.getElementById('menu').innerHTML = html;
      });
  </script>

  <!-- Cabe√ßalho com t√≠tulo e m√™s atual -->
  <header>
    <h1>Calend√°rio de Eventos Pok√©mon GO</h1>
    <p id="mesAno"></p>
  </header>

  <!-- Controles para mudar o m√™s e exibir destaques -->
  <div class="controls">
    <button onclick="mudarMes(-1)">&#8592; M√™s Anterior</button>

    <!-- Container para os destaques (temporada + ticket do m√™s) -->
    <div id="destaquesMes" class="destaques-container">
      <div class="evento-destaque" id="eventoTemporada" style="display: none;"></div>
      <div class="evento-destaque" id="ticket_Mes" style="display: none;"></div>
    </div>

    <button onclick="mudarMes(1)">Pr√≥ximo M√™s &#8594;</button>
  </div>

  <!-- Caixa de busca de eventos -->
  <div style="text-align: center; margin: 10px;">
    <input type="text" id="buscaEvento" placeholder="üîç Buscar evento..." style="padding: 6px; width: 220px;">
    <button id="btnBuscar" style="padding: 6px 12px; margin-left: 6px; cursor: pointer;">Buscar</button>
  </div>

  <!-- Filtro por categoria -->
  <div id="filtro-categorias" style="padding: 10px; text-align: center;"></div>

  <!-- Labels dos dias da semana -->
  <div class="week-labels">
    <div>Dom</div>
    <div>Seg</div>
    <div>Ter</div>
    <div>Qua</div>
    <div>Qui</div>
    <div>Sex</div>
    <div>S√°b</div>
  </div>

  <!-- Container do calend√°rio (dias gerados por JS) -->
  <div class="grid-container" id="calendario">    <!-- Dias preenchidos pelo JS -->
  </div>

  <script>
    // Mapeamento dos nomes amig√°veis das categorias
    const nomesCategorias = {
      eventos: 'Eventos',
      pesquisas: 'Pesquisas',
      community_day: 'Dias da Comunidade',
      raids: 'Raids',
      raid_horas: 'Horas Lend√°rias',
      max_monday: 'Segundas Max',
      spotlights: 'Hora do Holofote'
      // adicione outras categorias que usar
    };

    // Carregar eventos do m√™s para o calend√°rio (v√°rias categorias)
    const categorias = ['eventos', 'pesquisas', 'community_day', 'raids', 'raid_horas', 'max_monday', 'spotlights'];

    // Data atual que o calend√°rio mostra
    let dataAtual = new Date();    // Objeto para armazenar eventos por data
    let eventos = {};

    // Fun√ß√£o para formatar datas (dd/mm e hora:min)
    function formatarData(iso) {
      const d = new Date(iso);
      return d.toLocaleString('pt-BR', {
        day: '2-digit',
        month: '2-digit',
        hour: '2-digit',
        minute: '2-digit'
      });
    }
      
      // Gera os checkbox de filtro de categorias
      function gerarCheckboxesCategorias(listaCategorias) {
        const container = document.getElementById('filtro-categorias');
        if (!container) {
          console.warn("Div de filtro-categorias n√£o encontrada.");
          return;
        }

        container.innerHTML = '';

        listaCategorias.forEach(cat => {
          const nomeAmigavel = nomesCategorias[cat] || cat;
      
          const label = document.createElement('label');
          label.style.marginRight = '12px';
          label.style.display = 'inline-block';
          label.style.color = '#fff';

          const checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          checkbox.value = cat;
          checkbox.checked = true;
          checkbox.classList.add('filtro-categoria');
          checkbox.addEventListener('change', aplicarFiltroCategorias);

          label.appendChild(checkbox);
          label.appendChild(document.createTextNode(' ' + nomeAmigavel));
          container.appendChild(label);
        });
      }

      // Aplica o filtro baseado nos checkboxes marcados
      function aplicarFiltroCategorias() {
        const selecionadas = Array.from(document.querySelectorAll('#filtro-categorias input[type="checkbox"]:checked'))
        .map(cb => cb.value);

        document.querySelectorAll(".event").forEach(el => {
          const categoria = el.getAttribute("data-categoria");
          if (selecionadas.includes(categoria)) {
            el.style.display = "";
          } else {
            el.style.display = "none";
          }
        });
      }

    // Fun√ß√£o para carregar eventos do arquivo JSON
    async function carregarEventos() {
    try {
      let dados;

      if (typeof Android !== 'undefined' && typeof Android.getJson === 'function') {
        // No app Android, usa a interface Java para obter JSON
        try {
          const json = Android.getJson();
          dados = JSON.parse(json);
        } catch (e) {
          console.error('Erro ao obter JSON via Android.getJson():', e);
        }
      }

      if (!dados) {
        // No navegador (ou se deu erro no Android), tenta carregar via fetch
        try {
          const resposta = await fetch('calendario_eventos_pokemongo.json');
          if (!resposta.ok) throw new Error('Erro ao carregar JSON via fetch');
          dados = await resposta.json();
        } catch (e) {
          console.error('Erro ao carregar JSON via fetch:', e);
          // Aqui pode tratar erro, exibir mensagem, etc.
          return;
        }
      }

        dadosGlobais = dados; // armazena para busca global

        eventos = {};

        const anoStr = String(dataAtual.getFullYear());
        const mesStr = String(dataAtual.getMonth() + 1).padStart(2, '0');

        const primeiroDiaMes = new Date(dataAtual.getFullYear(), dataAtual.getMonth(), 1);
        const ultimoDiaMes = new Date(dataAtual.getFullYear(), dataAtual.getMonth() + 1, 0);

        // Exibir destaque da temporada
        const divTemporada = document.getElementById('eventoTemporada');
        divTemporada.style.display = 'none';

        if (dados[anoStr] && dados[anoStr].temporadas) {
          const temporadaAtiva = dados[anoStr].temporadas.find(ev => {
            const inicio = new Date(ev.inicio);
            const fim = new Date(ev.fim);
            return fim >= primeiroDiaMes && inicio <= ultimoDiaMes;
          });
          if (temporadaAtiva) {
            divTemporada.style.display = 'inline-block';
            if (temporadaAtiva.link) {
              divTemporada.innerHTML = `
                <a href="${temporadaAtiva.link}" target="_blank" style="color: inherit; text-decoration: none;">
                  <img src="${temporadaAtiva.img}" alt="">
                  <strong>${temporadaAtiva.titulo}</strong><br>
                  <span class="horario">(${formatarData(temporadaAtiva.inicio)} ‚Äì ${formatarData(temporadaAtiva.fim)})</span>
                </a>
              `;
            } else {
              divTemporada.innerHTML = `
                <img src="${temporadaAtiva.img}" alt="">
                <strong>${temporadaAtiva.titulo}</strong><br>
                <span class="horario">(${formatarData(temporadaAtiva.inicio)} ‚Äì ${formatarData(temporadaAtiva.fim)})</span>
              `;
            }
          }
        }

        // Exibir destaque do ticket do m√™s
        const divTicket = document.getElementById('ticket_Mes');
        divTicket.style.display = 'none';

        if (
          dados[anoStr] &&
          dados[anoStr].meses &&
          dados[anoStr].meses[mesStr] &&
          dados[anoStr].meses[mesStr].ticket_Mes
        ) {
          const ticket = dados[anoStr].meses[mesStr].ticket_Mes;
          const inicioMes = new Date(dataAtual.getFullYear(), dataAtual.getMonth(), 1);
          const fimMes = new Date(dataAtual.getFullYear(), dataAtual.getMonth() + 1, 0);

          if (ticket.inicio && ticket.fim) {
            const inicio = new Date(ticket.inicio);
            const fim = new Date(ticket.fim);

            if (fim >= inicioMes && inicio <= fimMes) {
              divTicket.style.display = 'inline-block';

              if (ticket.link) {
                divTicket.innerHTML = `
                  <a href="${ticket.link}" target="_blank" style="color: inherit; text-decoration: none;">
                    <img src="${ticket.img}" alt="">
                    <strong>${ticket.titulo}</strong><br>
                    <span class="horario">(${formatarData(ticket.inicio)} ‚Äì ${formatarData(ticket.fim)})</span>
                  </a>
                `;
              } else {
                divTicket.innerHTML = `
                  <img src="${ticket.img}" alt="">
                  <strong>${ticket.titulo}</strong><br>
                  <span class="horario">(${formatarData(ticket.inicio)} ‚Äì ${formatarData(ticket.fim)})</span>
                `;
              }
            }
          }
        }

        if (dados[anoStr] && dados[anoStr].meses && dados[anoStr].meses[mesStr]) {
          categorias.forEach(categoria => {
            const lista = dados[anoStr].meses[mesStr][categoria];
            if (Array.isArray(lista)) {
              lista.forEach(ev => {
                function parseDataLocal(isoDate) {
                  const [ano, mes, dia] = isoDate.split('T')[0].split('-');
                  return new Date(Number(ano), Number(mes) - 1, Number(dia));
                }

                let dataAtualEvento = parseDataLocal(ev.data_inicio);
                const dataFimEvento = parseDataLocal(ev.data_fim);

                while (dataAtualEvento <= dataFimEvento) {
                  const ano = dataAtualEvento.getFullYear();
                  const mes = String(dataAtualEvento.getMonth() + 1).padStart(2, '0');
                  const dia = String(dataAtualEvento.getDate()).padStart(2, '0');
                  const dataStr = `${ano}-${mes}-${dia}`;
                  const mostrarHorario = (() => {
                    if (ev.data_inicio === ev.data_fim) {
                      return `(${ev.hora_inicio} ‚Äì ${ev.hora_fim})`;
                    } else if (dataStr === ev.data_inicio) {
                      return `(Inicio:${ev.hora_inicio})`;
                    } else if (dataStr === ev.data_fim) {
                      return `(Termina:${ev.hora_fim})`;
                    } else {
                      return '';
                    }
                  })();

                  if (!eventos[dataStr]) eventos[dataStr] = [];

                  eventos[dataStr].push({
                    texto: {
                      titulo: ev.titulo,
                      horario: mostrarHorario
                    },
                    img: ev.img || 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/event.png',
                    link: ev.link || null,
                    categoria: categoria // << adiciona a categoria aqui
                  });

                  dataAtualEvento.setDate(dataAtualEvento.getDate() + 1);
                }
              });
            }
          });
        }

function formatarCategoria(categoria) {
  return categoria.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
}

        renderizarCalendario();
      } catch (erro) {
        console.error('Erro ao carregar eventos:', erro);
      }
    }

    // Fun√ß√£o para renderizar o calend√°rio
    function renderizarCalendario() {
      const container = document.getElementById('calendario');
      const mesAno = document.getElementById('mesAno');
      container.innerHTML = '';

      const ano = dataAtual.getFullYear();
      const mes = dataAtual.getMonth();

      // Exibe o m√™s e ano no cabe√ßalho
      mesAno.textContent = dataAtual.toLocaleDateString('pt-BR', {
        month: 'long',
        year: 'numeric'
      });

      const primeiroDiaSemana = new Date(ano, mes, 1).getDay();
      const diasNoMes = new Date(ano, mes + 1, 0).getDate();

      // Espa√ßos vazios antes do primeiro dia do m√™s (para alinhar os dias da semana)
      for (let i = 0; i < primeiroDiaSemana; i++) {
        container.appendChild(document.createElement('div'));
      }

      // Criar c√©lulas para cada dia do m√™s
      for (let dia = 1; dia <= diasNoMes; dia++) {
        const dataLocal = new Date(ano, mes, dia);
        const anoStr = dataLocal.getFullYear();
        const mesStr = String(dataLocal.getMonth() + 1).padStart(2, '0');
        const diaStr = String(dataLocal.getDate()).padStart(2, '0');
        const dataStr = `${anoStr}-${mesStr}-${diaStr}`;
        const celula = document.createElement('div');
        celula.className = 'day-cell';

        const rotulo = document.createElement('div');
        rotulo.className = 'day-label';
        rotulo.textContent = dia;
        celula.appendChild(rotulo);

        // Verifica se √© o dia atual e aplica classe especial
        const hoje = new Date();
        if (
          dataLocal.getDate() === hoje.getDate() &&
          dataLocal.getMonth() === hoje.getMonth() &&
          dataLocal.getFullYear() === hoje.getFullYear()
        ) {
          celula.classList.add('hoje');
        }

        // Adicionar eventos do dia, se houver
        if (eventos[dataStr]) {
          eventos[dataStr].forEach(ev => {
            const div = document.createElement('div');
            div.classList.add('event');      // para aplicar o filtro
            div.setAttribute('data-categoria', ev.categoria);      // para o filtro saber a qual categoria pertence

            if (ev.link) {
              div.innerHTML = `
                <a href="${ev.link}" target="_blank" style="color: inherit; text-decoration: none;">
                  <img src="${ev.img}" alt="">
                  <div><strong>${ev.texto.titulo}</strong></div>
                  <div style="font-size: 10px; color: #ccc;">${ev.texto.horario}</div>
                </a>
              `;
            } else {
              div.innerHTML = `
                <img src="${ev.img}" alt="">
                <div><strong>${ev.texto.titulo}</strong></div>
                <div style="font-size: 10px; color: #ccc;">${ev.texto.horario}</div>
              `;
            }

            celula.appendChild(div);
          });
        }

        container.appendChild(celula);
      }
    }

    // Fun√ß√£o para mudar o m√™s e recarregar eventos
    function mudarMes(delta) {
      dataAtual.setMonth(dataAtual.getMonth() + delta);
      carregarEventos();
    }

    // Busca global simples: encontra o m√™s e ano do primeiro evento que cont√©m o termo buscado
    function buscarEventoGlobalSimples(termoBusca) {
      termoBusca = termoBusca.toLowerCase();

      for (const ano in dadosGlobais) {
        if (!dadosGlobais.hasOwnProperty(ano)) continue;
        const meses = dadosGlobais[ano].meses;
        if (!meses) continue;

        for (const mes in meses) {
          if (!meses.hasOwnProperty(mes)) continue;

          // Categorias poss√≠veis
          const categorias = ['ticket_Mes', 'eventos', 'pesquisas', 'community_day', 'raids', 'raid_horas', 'max_monday', 'spotlights'];

          for (const cat of categorias) {
            const lista = meses[mes][cat];
            if (!lista) continue;

            if (Array.isArray(lista)) {
			  for (const ev of lista) {
			    if (!ev.titulo) continue;
				if (ev.titulo.toLowerCase().includes(termoBusca)) {
				  // Retorna o ano e m√™s do evento encontrado
				  return { ano: Number(ano), mes: Number(mes) - 1 }; // m√™s zero-based para Date
				}
			  }
			}
		  }
        }
      }
    return null; // N√£o achou
  }

  // Evento click do bot√£o Buscar
  document.getElementById('btnBuscar').addEventListener('click', () => {
    const termoBusca = document.getElementById('buscaEvento').value.trim();
    if (termoBusca.length === 0) return; // Nenhum termo, n√£o faz nada

    const resultado = buscarEventoGlobalSimples(termoBusca);
    if (resultado) {
      dataAtual = new Date(resultado.ano, resultado.mes, 1);
      carregarEventos();
    }
  });

    // Carrega os eventos na inicializa√ß√£o
    carregarEventos().then(() => {
      gerarCheckboxesCategorias(categorias);
      aplicarFiltroCategorias();
    });

  </script>

  <!-- Modal com QR Code PIX -->
  <div id="pix-modal" style="
    position: fixed;
    bottom: 10px;
    right: 10px;
    background: #1f1f1f;
    border: 2px solid #444;
    padding: 10px;
    border-radius: 12px;
    z-index: 9999;
    box-shadow: 0 0 10px rgba(0,0,0,0.5);
    max-width: 170px;
    text-align: center;
    color: #fff;
    font-family: Arial, sans-serif;
  ">
    <div style="text-align: right;">
      <button onclick="document.getElementById('pix-modal').style.display='none'" style="
      background: transparent;
      border: none;
      color: #fff;
      font-size: 12px;
      cursor: pointer;
      line-height: 1;
    ">‚úï</button>
    </div>
    <p style="margin-top: 0; font-size: 14px;">Ajude a melhorar o site <br>fazendo uma doa√ß√£o.</p>
    <img src="https://static.wixstatic.com/media/547906_18d83fe6ead44cbdb360b0658479ea09~mv2.jpeg" alt="QR Code PIX"
      style="width: 100%; border-radius: 8px;">
  </div>

</body>

</html>