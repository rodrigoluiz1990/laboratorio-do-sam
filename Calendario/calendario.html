<!DOCTYPE html>
<html lang="pt-br">

<head>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="../css/menu.css">
  <link rel="stylesheet" href="../css/calendario.css">
  <meta charset="UTF-8" />
  <link rel="icon" href="../Assets/logo-gs2.png" type="image/png">
  <title>Calend√°rio Pok√©mon GO</title>
</head>

<body>
  <!-- Menu carregado dinamicamente -->
  <div id="menu"></div>

  <!-- Script para carregar o menu -->
  <script>
    fetch('../menu.html')
      .then(response => response.text())
      .then(html => {
        document.getElementById('menu').innerHTML = html;
      });

    // Pedir permiss√£o para notifica√ß√µes assim que a p√°gina carregar
    window.addEventListener('load', () => {
      if (Notification.permission === "default") { // ainda n√£o concedida nem negada
        Notification.requestPermission().then(permission => {
          if (permission === "granted") {
            console.log("Permiss√£o para notifica√ß√µes concedida!");
          } else {
            console.log("Permiss√£o para notifica√ß√µes negada ou recusada.");
          }
        });
      }
    });

  </script>

  <!-- Cabe√ßalho com t√≠tulo e m√™s atual -->
  <header>
    <h1 style="margin-bottom: 10px;">Calend√°rio de Eventos Pok√©mon GO</h1>
    <p id="mesAno" style="display: none;"></p>

  <!-- Calendario para navegar entre mes e ano -->
  <div class="calendar-header">
    <select id="selectMes" class="calendar-select">
        <option value="1">Janeiro</option>
        <option value="2">Fevereiro</option>
        <option value="3">Mar√ßo</option>
        <option value="4">Abril</option>
        <option value="5">Maio</option>
        <option value="6">Junho</option>
        <option value="7">Julho</option>
        <option value="8">Agosto</option>
        <option value="9">Setembro</option>
        <option value="10">Outubro</option>
        <option value="11">Novembro</option>
        <option value="12">Dezembro</option>
    </select>

    <select id="selectAno" class="calendar-select"></select>

    <label class="switch">
      <input type="checkbox" id="toggleNotificacoes" />
      <span class="slider"></span>
    </label>
    <span id="labelNotificacao">Ativar notifica√ß√µes</span>
    
  </div>

    <!-- Controles para mudar o m√™s e exibir destaques -->
    <div class="controls">
      <button onclick="mudarMes(-1)">&#8592; M√™s Anterior</button>
      <button id="btnHoje">Hoje</button>
      <button onclick="mudarMes(1)">Pr√≥ximo M√™s &#8594;</button>
    </div>

  </header>

  <!-- Container para os destaques (season + passe do m√™s) -->
  <div id="destaquesMes" class="destaques-container">
    <div class="evento-destaque" id="eventoSeason" style="display: none;"></div>
    <div class="evento-destaque" id="go_pass" style="display: none;"></div>
  </div>


  <!-- Caixa de busca de eventos -->
  <div class="search-container">
    <input type="text" id="buscaEvento" class="search-input" placeholder="üîç Buscar evento...">
    <button id="btnBuscar" class="search-button">Buscar</button>
  </div>

  <!-- Filtro por categoria -->
  <div id="filtro-categorias" style="padding: 10px; text-align: center;"></div>

  <!-- Labels dos dias da semana -->
  <div class="week-labels">
    <div>Dom</div>
    <div>Seg</div>
    <div>Ter</div>
    <div>Qua</div>
    <div>Qui</div>
    <div>Sex</div>
    <div>S√°b</div>
  </div>

  <!-- Container do calend√°rio (dias gerados por JS) -->
  <div class="grid-container" id="calendario">    <!-- Dias preenchidos pelo JS -->
  </div>

  <!-- define dadosGlobais, carregarEvents() -->
  <script src="dados.js"></script>

  <script>
    // Mapeamento dos nomes amig√°veis das categorias
    const nomesCategorias = {
      events: 'Evento',
      research: 'Pesquisa',
      community_day: 'Dia da Comunidade',
      raid: 'Raid',
      raid_hour: 'Hora Lend√°ria',
      raid_mega: 'Mega Raid',
      raid_shadow: 'Raid Sombrosa',
      dynamax: 'Dynamax',
      gigantamax: 'Gigantamax',
      max_monday: 'Segunda Max',
      spotlights: 'Hora do Holofote'
      // adicione outras categorias que usar
    };

    // Carregar eventos do m√™s para o calend√°rio (v√°rias categorias)
    const categorias = ['events', 'research', 'community_day', 'raid', 'raid_hour', 'raid_mega', 'raid_shadow', 'dynamax', 'gigantamax', 'max_monday', 'spotlights'];

    // Fun√ß√£o para formatar datas (dd/mm e hora:min)
    function formatarData(iso) {
      const d = new Date(iso);
      return d.toLocaleString('pt-BR', {
        day: '2-digit',
        month: '2-digit',
        hour: '2-digit',
        minute: '2-digit'
      });
    }
      
    // Gera os checkbox de filtro de categorias
    function gerarCheckboxesCategorias(listaCategorias) {
      const container = document.getElementById('filtro-categorias');
      if (!container) {
        console.warn("Div de filtro-categorias n√£o encontrada.");
        return;
      }

      container.innerHTML = '';

      listaCategorias.forEach(cat => {
        const nomeAmigavel = nomesCategorias[cat] || cat;

        const label = document.createElement('label');
        label.className = 'filtro-item ativo'; // Come√ßa como ativo (checkbox marcado)

        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.value = cat;
        checkbox.checked = true;
        checkbox.classList.add('filtro-categoria');

        checkbox.addEventListener('change', function () {
          aplicarFiltroCategorias(); // sua fun√ß√£o j√° existente
          label.classList.toggle('ativo', checkbox.checked);
        });

        const icon = document.createElement('img');
        const iconesCategorias = {
          events: 'icon-event2.png',
          research: 'icon-research.png',
          community_day: 'icon-community-day.png',
          max_monday: 'icon-powerstop.png',
          spotlights: 'icon-encounter.png',
          raid: 'icon-raid.png',
          raid_hour: 'icon-raid-hour.png',
          raid_mega: 'icon-raid-mega.png',
          raid_shadow: 'icon-raid-shadow.png',
          dynamax: 'icon-dynamax.png',
          gigantamax: 'icon-gigantamax.png',
          // voc√™ pode adicionar outros aqui conforme necess√°rio
        };

        icon.src = `../Assets/${iconesCategorias[cat] || 'icon-default.png'}`;
        icon.alt = nomeAmigavel;

        const span = document.createElement('span');
        span.textContent = nomeAmigavel;

        label.appendChild(checkbox);
        label.appendChild(icon);
        label.appendChild(span);

        container.appendChild(label);
      });
    }

    // Aplica o filtro baseado nos checkboxes marcados
    function aplicarFiltroCategorias() {
      const selecionadas = Array.from(document.querySelectorAll('#filtro-categorias input[type="checkbox"]:checked'))
      .map(cb => cb.value);

      document.querySelectorAll(".event").forEach(el => {
        const categoria = el.getAttribute("data-categoria");
        if (selecionadas.includes(categoria)) {
          el.style.display = "";
        } else {
          el.style.display = "none";
        }
      });
    }
    
      // Fun√ß√£o para renderizar o calend√°rio
      function renderizarCalendario() {
        const container = document.getElementById('calendario');
        const mesAno = document.getElementById('mesAno');
        container.innerHTML = '';

        const ano = dataAtual.getFullYear();
        const mes = dataAtual.getMonth();

        const primeiroDiaSemana = new Date(ano, mes, 1).getDay();
        const diasNoMes = new Date(ano, mes + 1, 0).getDate();

        // Espa√ßos vazios antes do primeiro dia do m√™s (para alinhar os dias da semana)
        for (let i = 0; i < primeiroDiaSemana; i++) {
          container.appendChild(document.createElement('div'));
        }

        // Criar c√©lulas para cada dia do m√™s
        for (let dia = 1; dia <= diasNoMes; dia++) {
          const dataLocal = new Date(ano, mes, dia);
          const anoStr = dataLocal.getFullYear();
          const mesStr = String(dataLocal.getMonth() + 1).padStart(2, '0');
          const diaStr = String(dataLocal.getDate()).padStart(2, '0');
          const dataStr = `${anoStr}-${mesStr}-${diaStr}`;
          const celula = document.createElement('div');
          celula.className = 'day-cell';

          const rotulo = document.createElement('div');
          rotulo.className = 'day-label';
          rotulo.textContent = dia;
          celula.appendChild(rotulo);

          // Verifica se √© o dia atual e aplica classe especial
          const hoje = new Date();
          if (
            dataLocal.getDate() === hoje.getDate() &&
            dataLocal.getMonth() === hoje.getMonth() &&
            dataLocal.getFullYear() === hoje.getFullYear()
          ) {
            celula.classList.add('hoje');
          }

        // Adicionar eventos do dia, se houver
        if (events[dataStr]) {
          events[dataStr].forEach(ev => {
            const div = document.createElement('div');
            div.classList.add('event');      // para aplicar o filtro
            div.setAttribute('data-categoria', ev.categoria);      // para o filtro saber a qual categoria pertence

            if (ev.link) {
              div.innerHTML = `
                <a href="${ev.link}" target="_blank" style="color: inherit; text-decoration: none;">
                  <img src="${ev.img}" alt="">
                  <div><strong>${ev.texto.titulo}</strong></div>
                  <div class="event-time">${ev.texto.horario}</div>
                </a>
              `;
            } else {
              div.innerHTML = `
                <img src="${ev.img}" alt="">
                <div><strong>${ev.texto.titulo}</strong></div>
                <div class="event-time">${ev.texto.horario}</div>
              `;
            }

            celula.appendChild(div);
          });

          // Destacar o dia se algum evento contiver o termo buscado
          if (termoBuscaGlobal && events[dataStr]) {
            const encontrou = events[dataStr].some(ev =>
            ev.texto.titulo.toLowerCase().includes(termoBuscaGlobal.toLowerCase())
            );
            if (encontrou) {
              celula.classList.add('encontrado');
            }
          }
        }

        container.appendChild(celula);
      }
    }


  // Carrega os eventos na inicializa√ß√£o
  carregarEvents().then(() => {
    gerarCheckboxesCategorias(categorias);
    aplicarFiltroCategorias();
  });

  </script>

  <script>
    var dataAtual = new Date();
  </script>

  <script src="controleCalendario.js"></script>
  <script>
    inicializarControleCalendario(dataAtual, carregarEvents);
  </script>
  <script src="buscaEventos.js"></script>

  <!-- Modal com QR Code PIX -->
  <div id="pix-modal" class="pix-modal">
    <button class="pix-close" onclick="document.getElementById('pix-modal').style.display='none'">‚úï</button>
    <p class="pix-text">üíñ Ajude a melhorar o site <br>fazendo uma doa√ß√£o.</p>
    <img src="https://static.wixstatic.com/media/547906_18d83fe6ead44cbdb360b0658479ea09~mv2.jpeg" 
        alt="QR Code PIX" class="pix-img">
  </div>

    <script src="notificacoes.js"></script>
  </body>
</html>